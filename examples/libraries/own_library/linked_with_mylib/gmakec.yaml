description: Own library linkage gmakec sample
version: "1.0.0"

compilers:
  - name: gcc-default
    path: gcc
    flags:
      - -Wall
      - -Wextra
      - -pedantic

targets:
  - compiler:
      ref: gcc-default
    sources:
      - ../independent/main.c
    output: build/independent
    hooks:
      - step: preConfigure
        command: echo "preConfigure independent first"
      - step: preConfigure
        command: echo "preConfigure independent second"
      - step: postConfigure
        command: echo "postConfigure independent first"
      - step: postConfigure
        command: echo "postConfigure independent second"
      - step: preBuild
        command: echo "preBuild independent first"
      - step: preBuild
        command: echo "preBuild independent second"
      - step: postBuild
        command: echo "postBuild independent first"
      - step: postBuild
        command: echo "postBuild independent second ${HOME}"

  - name: libobject
    compiler:
      ref: gcc-default
      flags:
        - -c
        - -fPIC
    sources:
      - ../mylib/mylib.c
    includes:
      - ../mylib
    output: ../mylib/lib/myownlib.o

  - name: libso
    compiler:
      ref: gcc-default
      flags:
        - -shared
        - -fPIC
        - -Wl,-soname,libmyown.so
        - -lc
    sources:
      - libobject:output
    output: ../mylib/lib/libmyown.so
    dependencies:
      - libobject

  - compiler:
      ref: gcc-default
    sources:
      - src/main.c
    includes:
      - ../mylib
    links:
      - path: libso:output
        link: -lmyown
    output: build/linked-with-mylib
    dependencies:
      - libso
